# SSH隧道管理器

一个功能完善的SSH隧道管理工具，支持本地、远程和动态端口转发，具备自动重连和智能监控功能。

> **重要声明**: 本项目的代码完全由人工智能（Claude AI）生成，包括核心功能实现、用户界面设计和文档编写。

## 功能特性

- 🚀 **简洁直观的TUI界面**: 基于Bubble Tea框架的现代化终端用户界面
- 🔄 **三种隧道类型**: 支持本地端口转发、远程端口转发和动态端口转发(SOCKS5)
- 💾 **配置持久化**: 自动保存和恢复隧道配置
- 📊 **实时状态监控**: 显示隧道运行状态和连接信息
- 🎨 **美观的界面**: 色彩丰富的状态显示和操作提示
- 🔐 **SSH密钥认证**: 支持基于密钥的SSH身份验证
- 🔄 **智能自动重连**: 连接断开时自动重建，支持指数退避策略
- ⚙️ **高级SSH参数**: 支持常用SSH参数配置(-f, -N, -g, -C, -q等)
- 🛡️ **操作安全**: 删除操作需要二次确认，防止误操作
- 🌐 **完整中文支持**: 界面和提示信息完全中文化

## 安装

### 从源码构建

确保您的系统已安装Go 1.25.0或更高版本：

```bash
# 克隆项目
git clone <repository-url>
cd ssh_tunnel_manager

# 下载依赖
go mod download

# 构建可执行文件
go build -o ssh-tunnel-manager.exe .
```

## 使用方法

### 启动应用

```bash
./ssh-tunnel-manager.exe
```

### 界面操作

#### 主界面控制
- `↑/↓` 或 `k/j`: 在隧道列表中导航
- `回车` 或 `空格`: 查看隧道详情
- `a`: 添加新隧道
- `e`: 编辑选中的隧道
- `d`: 删除选中的隧道（需要确认）
- `s`: 启动/停止选中的隧道
- `q`: 退出应用

#### 添加/编辑隧道界面
- `↑/↓` 或 `k/j`: 在表单字段间导航
- `输入文字`: 编辑当前字段
- `退格键`: 删除字符
- `回车`: 保存隧道配置
- `Esc`: 取消并返回主界面

#### 详情查看界面
- `s`: 启动/停止当前隧道
- `q` 或 `Esc`: 返回主界面

#### 删除确认界面
- `Y` 或 `回车`: 确认删除
- `N` 或 `Esc`: 取消删除

## 隧道类型详解

### 本地端口转发 (Local Tunnel)
将本地端口的流量转发到远程主机。

**使用场景**: 访问远程数据库、内网服务
```
配置示例:
- 本地端口: 3306
- 远程主机: database.internal
- 远程端口: 3306
- SSH主机: jump-server.example.com

访问方式: localhost:3306 → database.internal:3306
```

### 远程端口转发 (Remote Tunnel)
将远程端口的流量转发回本地主机。

**使用场景**: 将本地服务暴露给远程网络
```
配置示例:
- 本地端口: 8080
- 远程主机: localhost
- 远程端口: 8080
- SSH主机: public-server.example.com

访问方式: public-server.example.com:8080 → localhost:8080
```

### 动态端口转发 (Dynamic Tunnel - SOCKS5)
创建SOCKS5代理服务器，通过SSH服务器转发流量。

**使用场景**: 网页浏览代理、通用网络代理
```
配置示例:
- 本地端口: 1080
- SSH主机: proxy-server.example.com

使用方式: 配置浏览器使用SOCKS5代理 localhost:1080
```

## SSH连接参数详解

在创建或编辑隧道时，可以配置以下SSH参数：

### 基础参数
- **后台运行 (-f)**: SSH连接在后台运行 (true/false)
- **不执行远程命令 (-N)**: 仅进行端口转发，不执行远程命令 (true/false)
- **允许远程连接 (-g)**: 允许远程主机连接到本地转发端口 (true/false)
- **启用压缩 (-C)**: 在慢速连接上启用压缩以提高性能 (true/false)
- **安静模式 (-q)**: 抑制警告和诊断消息 (true/false)

### 保活参数
- **保持连接活跃**: 启用SSH保活机制 (true/false)
- **服务器活跃间隔**: 发送保活消息的间隔时间（秒，默认: 60）

## 自动重连功能

SSH隧道管理器包含先进的自动重连功能，确保隧道稳定性和可靠性。

### 配置选项

#### 基本设置
- **启用自动重连**: 启用/禁用自动重连 (true/false)
- **重连间隔**: 重连尝试之间的基本间隔时间（秒，默认: 10）
- **最大重连次数**: 最大重连尝试次数（0 = 无限制，默认: 0）
- **启用指数退避重连**: 启用重连延迟的指数退避 (true/false)

#### 工作原理

1. **连接监控**: 系统使用保活消息持续监控SSH连接
2. **自动检测**: 检测到连接故障时，自动重连机制激活
3. **智能重试**: 根据可配置的间隔进行重连尝试，支持指数退避
4. **状态跟踪**: 系统跟踪重连尝试并显示详细状态信息

#### 指数退避

启用时，重连延迟按指数增长：
- 第1次尝试: 基本间隔（如10秒）
- 第2次尝试: 2倍基本间隔（20秒）
- 第3次尝试: 4倍基本间隔（40秒）
- 最大延迟限制为60秒

### 推荐配置

**关键服务（数据库、API）**:
```
自动重连: true
重连间隔: 5秒
最大尝试次数: 20（防止无限循环）
指数退避: true
```

**一般使用（网页浏览、文件传输）**:
```
自动重连: true
重连间隔: 10秒
最大尝试次数: 0（无限制）
指数退避: true
```

**测试/开发环境**:
```
自动重连: false（立即发现连接问题）
```

### 重连监控

隧道详情界面显示全面的重连信息：
- 当前重连状态
- 重连尝试次数
- 最后重连时间戳
- 配置参数

### 日志记录

非安静模式下（`-q`），系统记录：
- 连接丢失检测
- 重连尝试通知
- 成功/失败状态
- 退避延迟信息

## 配置文件

隧道配置自动保存在：
- **Windows**: `%USERPROFILE%\.ssh-tunnel-manager\tunnels.json`
- **Linux/macOS**: `~/.ssh-tunnel-manager/tunnels.json`

## SSH身份验证

应用程序支持SSH密钥身份验证。在创建隧道时在"SSH密钥路径"字段中指定私钥文件路径。

如果未提供密钥路径，应用程序将尝试使用默认的SSH代理身份验证。

## 配置示例

### 数据库访问隧道
```
名称: 生产数据库连接
类型: local
本地端口: 3306
远程主机: prod-db.internal.company.com
远程端口: 3306
SSH主机: bastion.company.com
SSH端口: 22
SSH用户: username
SSH密钥路径: /home/user/.ssh/id_rsa
不执行远程命令: true
保持连接活跃: true
自动重连: true
重连间隔: 5秒
最大重连次数: 20
指数退避: true
```

### SOCKS5代理隧道
```
名称: 国际网络代理
类型: dynamic
本地端口: 1080
SSH主机: overseas-server.example.com
SSH端口: 22
SSH用户: proxy_user
启用压缩: true
保持连接活跃: true
自动重连: true
重连间隔: 10秒
```

## 故障排除

### 连接问题
- 验证SSH凭据和主机可访问性
- 检查本地/远程端口是否已被占用
- 确保SSH密钥文件权限正确（600）

### 权限被拒绝
- 验证SSH用户具有适当权限
- 检查SSH密钥文件是否存在且可读

### 端口已被占用
- 选择不同的本地端口
- 停止使用相同端口的冲突服务

## 开发信息

### 技术栈
- **语言**: Go 1.25.0
- **TUI框架**: [Bubble Tea](https://github.com/charmbracelet/bubbletea)
- **样式库**: [Lip Gloss](https://github.com/charmbracelet/lipgloss)
- **SSH客户端**: [Go SSH](https://golang.org/x/crypto/ssh)

### 项目结构
```
├── main.go          # 应用程序入口点
├── tunnel.go        # SSH隧道管理核心逻辑
├── ui.go            # TUI界面实现
├── go.mod           # Go模块定义
├── README.md        # 英文文档
├── README_CN.md     # 中文文档
└── CLAUDE.md        # 开发者指南
```

### 构建和测试
```bash
# 下载依赖
go mod download

# 格式化代码
go fmt ./...

# 代码检查
go vet ./...

# 构建
go build -o ssh-tunnel-manager .

# 运行
./ssh-tunnel-manager
```

## AI代码声明

**重要**: 本项目的全部源代码均由Claude AI人工智能助手生成，包括但不限于：

- 🤖 **核心功能逻辑**: SSH隧道管理、自动重连机制
- 🎨 **用户界面设计**: TUI界面布局、交互逻辑
- 📝 **文档编写**: README、代码注释、使用说明
- 🔧 **配置管理**: JSON配置文件处理、参数验证
- 🛡️ **错误处理**: 异常捕获、用户提示、重连策略

### AI技术栈
- **AI模型**: Claude (Anthropic)
- **生成日期**: 2024年
- **代码质量**: 生产级别，包含完整的错误处理和用户体验优化

这个项目展示了AI在软件开发中的强大能力，从需求分析到代码实现，再到文档编写，全程由AI独立完成。

## 许可证

本项目采用开源许可证。您可以自由使用、修改和分发本软件。

## 支持与反馈

如果您在使用过程中遇到问题或有改进建议，请通过以下方式联系：

- 提交Issue报告问题
- 提交Pull Request贡献代码
- 在社区中分享使用经验

---

**享受高效的SSH隧道管理体验！** 🚀